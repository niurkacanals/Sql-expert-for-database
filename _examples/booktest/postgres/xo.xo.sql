-- Generated by xo for the public schema.

-- enum book_type
CREATE TYPE book_type AS ENUM (
  'FICTION',
  'NONFICTION'
);

-- table authors
CREATE TABLE authors (
  author_id SERIAL,
  name VARCHAR(255) DEFAULT '' NOT NULL,
  PRIMARY KEY (author_id)
);

-- index authors_name_idx
CREATE INDEX authors_name_idx ON authors (name);

-- table books
CREATE TABLE books (
  book_id SERIAL,
  author_id INTEGER NOT NULL REFERENCES authors (author_id),
  isbn VARCHAR(255) DEFAULT '' NOT NULL,
  book_type BOOK_TYPE DEFAULT 'FICTION' NOT NULL,
  title VARCHAR(255) DEFAULT '' NOT NULL,
  year INTEGER DEFAULT 2000 NOT NULL,
  available TIMESTAMPTZ DEFAULT now() NOT NULL,
  description TEXT DEFAULT '' NOT NULL,
  tags VARCHAR[] DEFAULT '{}' NOT NULL,
  UNIQUE (isbn),
  PRIMARY KEY (book_id)
);

-- index books_title_idx
CREATE INDEX books_title_idx ON books (title, year);

-- function say_hello
CREATE FUNCTION say_hello(name VARCHAR) RETURNS VARCHAR AS $$
BEGIN
  RETURN 'hello ' || name;
END;
$$ LANGUAGE plpgsql;
