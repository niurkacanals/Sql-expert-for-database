// Package models contains the types for schema 'public'.
package models

// GENERATED BY XO. DO NOT EDIT.

// Proc represents a PostgreSQL stored procedure.
type Proc struct {
	ProcName       string // proc_name
	ParameterTypes string // parameter_types
	ReturnType     string // return_type
	Comment        string // comment
}

// ProcsBySchema runs a custom query, returning results as Proc.
func ProcsBySchema(db XODB, schema string) ([]*Proc, error) {
	var err error

	// sql query
	const sqlstr = `SELECT ` +
		`p.proname, ` + // ::varchar AS proc_name
		`oidvectortypes(p.proargtypes), ` + // ::varchar AS parameter_types
		`pg_get_function_result(p.oid), ` + // ::varchar AS return_type
		`'' ` + // ::varchar AS comment
		`FROM pg_proc p ` +
		`INNER JOIN pg_namespace n ON p.pronamespace = n.oid ` +
		`WHERE n.nspname = $1`

	// run query
	q, err := db.Query(sqlstr, schema)
	if err != nil {
		return nil, err
	}
	defer q.Close()

	// load results
	res := []*Proc{}
	for q.Next() {
		p := Proc{}

		// scan
		err = q.Scan(&p.ProcName, &p.ParameterTypes, &p.ReturnType, &p.Comment)
		if err != nil {
			return nil, err
		}

		res = append(res, &p)
	}

	return res, nil
}
